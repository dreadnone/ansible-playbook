---
- name: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
  hosts: localhost
  connection: local
  gather_facts: no
  
  tasks:
    - name: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
      ansible.builtin.debug:
        msg: |
          –ü–†–û–í–ï–†–ö–ê –°–¢–†–£–ö–¢–£–†–´ –ü–†–û–ï–ö–¢–ê:
          ===========================
          1. –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:
             - site.yml: {{ lookup('ansible.builtin.stat', 'site.yml').exists }}
             - requirements.yml: {{ lookup('ansible.builtin.stat', 'requirements.yml').exists }}
             - inventory.yml: {{ lookup('ansible.builtin.stat', 'inventory.yml').exists }}
          
          2. –†–æ–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
             - clickhouse: {{ lookup('ansible.builtin.stat', 'roles/clickhouse').exists }}
             - vector_role: {{ lookup('ansible.builtin.stat', 'roles/vector_role').exists }}
             - lighthouse_role: {{ lookup('ansible.builtin.stat', 'roles/lighthouse_role').exists }}
          
          3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vector:
             - defaults: {{ lookup('ansible.builtin.stat', 'roles/vector_role/defaults/main.yml').exists }}
             - templates: {{ lookup('ansible.builtin.stat', 'roles/vector_role/templates/vector.yml.j2').exists }}
    
    - name: –ü—Ä–æ–≤–µ—Ä–∫–∞ ClickHouse sink –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
      ansible.builtin.slurp:
        src: roles/vector_role/defaults/main.yml
      register: vector_config
    
    - name: –í—ã–≤–µ—Å—Ç–∏ ClickHouse sink –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
      ansible.builtin.debug:
        msg: |
          ‚úÖ VECTOR –ù–ê–°–¢–†–û–ï–ù –î–õ–Ø CLICKHOUSE:
          
          –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è sinks:
          {{ (vector_config.content | b64decode | from_yaml).vector_sinks | to_nice_yaml }}
          
          –¢–∏–ø: clickhouse
          –•–æ—Å—Ç: {{ (vector_config.content | b64decode | from_yaml).vector_sinks.clickhouse_logs.host }}
          –ü–æ—Ä—Ç: {{ (vector_config.content | b64decode | from_yaml).vector_sinks.clickhouse_logs.port }}
          –ë–∞–∑–∞: {{ (vector_config.content | b64decode | from_yaml).vector_sinks.clickhouse_logs.database }}
          –¢–∞–±–ª–∏—Ü–∞: {{ (vector_config.content | b64decode | from_yaml).vector_sinks.clickhouse_logs.table }}
    
    - name: –ü—Ä–æ–≤–µ—Ä–∫–∞ requirements.yml
      ansible.builtin.slurp:
        src: requirements.yml
      register: reqs
    
    - name: –í—ã–≤–µ—Å—Ç–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      ansible.builtin.debug:
        msg: |
          ‚úÖ DEPENDENCIES CONFIGURED:
          {{ reqs.content | b64decode }}
    
    - name: –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
      ansible.builtin.debug:
        msg: |
          üéâ –ó–ê–î–ê–ù–ò–ï –í–´–ü–û–õ–ù–ï–ù–û –£–°–ü–ï–®–ù–û!
          
          –í–°–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø –í–´–ü–û–õ–ù–ï–ù–´:
          =========================
          1. ‚úì –°–æ–∑–¥–∞–Ω—ã –¥–≤–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å —Ä–æ–ª—è–º–∏
          2. ‚úì –†–æ–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –∑–∞–¥–∞—á–∏, —à–∞–±–ª–æ–Ω—ã –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
          3. ‚úì Vector –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ ClickHouse (sinks)
          4. ‚úì –ù–∞–ø–∏—Å–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ README.md
          5. ‚úì –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è (v1.0.0)
          6. ‚úì –°–æ–∑–¥–∞–Ω playbook —Å requirements.yml
          7. ‚úì Playbook –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–æ–ª–∏
          
          –°–°–´–õ–ö–ò –î–õ–Ø –°–î–ê–ß–ò:
          ================
          1. Vector role: https://github.com/dreadnone/vector-role
          2. Lighthouse role: https://github.com/dreadnone/lighthouse-role
          3. Playbook: https://github.com/dreadnone/ansible-playbook
          
          –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û:
          - Vector role –∏–º–µ–µ—Ç —Ç–µ–≥ v1.0.0
          - Lighthouse role –∏–º–µ–µ—Ç —Ç–µ–≥ v1.0.0
          - Vector —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω —Å ClickHouse sink
          - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞ –≤ README —Ñ–∞–π–ª—ã
